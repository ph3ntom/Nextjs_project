# [2025-07-26] 회원가입 페이지 수정 명세서

## 개요
Next.js 회원가입 페이지에서 발생한 Hydration 오류와 API 연동 문제들을 해결하고, 백엔드 서버와의 올바른 통신을 구현했습니다.

## 수정된 문제들

### 1. Hydration 오류 해결
**문제**: 테마(다크/라이트 모드) 기반 로고 렌더링 시 서버와 클라이언트 간 불일치로 인한 Hydration 오류 발생

**해결책**:
- `useEffect`와 `mounted` 상태를 활용한 클라이언트 사이드 렌더링 지연
- 서버 렌더링 시에는 기본 로고, 클라이언트 마운트 후 테마에 맞는 로고 표시

**수정 파일**:
- `components/header.tsx`
- `app/auth/signup/page.tsx`

**수정 코드**:
```typescript
const [mounted, setMounted] = useState(false)

useEffect(() => {
  setMounted(true)
}, [])

{mounted && theme === "dark" ? (
  <Image src="/logo-dark.svg" alt="DevForum Logo" width={50} height={50} className="h-12 w-12" />
) : (
  <Image src="/logo-light.svg" alt="DevForum Logo" width={50} height={50} className="h-12 w-12" />
)}
```

### 2. handleChange 함수 오타 수정
**문제**: 아이디 입력 필드 변경 시 중복 확인 상태 리셋이 작동하지 않는 문제

**원인**: `"usernId"` 오타로 인한 조건문 미작동

**해결책**: `"userId"`로 수정

**수정 전**:
```typescript
if (name === "usernId" && userIdChecked) {
```

**수정 후**:
```typescript
if (name === "userId" && userIdChecked) {
```

### 3. 회원가입 API 엔드포인트 수정
**문제**: 잘못된 API 엔드포인트로 인한 회원가입 실패

**수정 전**: `http://localhost:3001/register/CheckId`
**수정 후**: `http://localhost:3001/register/registerProcess`

### 4. 휴대폰 번호 유효성 검사 개선
**문제**: 백엔드에서 "phone must be a valid phone number" 오류 발생

**해결책**:
- 자동 포맷팅 함수 추가 (`formatPhoneNumber`)
- 정규식 기반 유효성 검증 추가
- 실시간 하이픈(-) 자동 삽입

**추가된 기능**:
```typescript
const formatPhoneNumber = (value: string) => {
  const phoneNumber = value.replace(/[^\d]/g, '')
  
  if (phoneNumber.length <= 3) {
    return phoneNumber
  } else if (phoneNumber.length <= 7) {
    return `${phoneNumber.slice(0, 3)}-${phoneNumber.slice(3)}`
  } else if (phoneNumber.length <= 11) {
    return `${phoneNumber.slice(0, 3)}-${phoneNumber.slice(3, 7)}-${phoneNumber.slice(7)}`
  }
  
  return `${phoneNumber.slice(0, 3)}-${phoneNumber.slice(3, 7)}-${phoneNumber.slice(7, 11)}`
}

// 유효성 검증
const phoneRegex = /^010-\d{4}-\d{4}$/
if (!phoneRegex.test(formData.phone)) {
  newErrors.phone = "올바른 휴대폰 번호 형식이 아닙니다. (010-0000-0000)"
}
```

### 5. checkIdPerformed 필드 추가
**문제**: 백엔드 DTO에서 아이디 중복 확인 여부를 boolean으로 요구하지만 전송하지 않음

**해결책**: 회원가입 요청 시 `checkIdPerformed` 필드 추가

**수정된 요청 body**:
```typescript
body: JSON.stringify({
  ...formData,
  checkIdPerformed: userIdAvailable
})
```

## API 구조 정리

### 아이디 중복 확인
- **경로**: Next.js API Route (`/api/check-id`) → 백엔드 서버 (`http://localhost:3001/register/CheckId`)
- **방식**: 프록시 패턴 사용

### 회원가입
- **경로**: Next.js 클라이언트 → 백엔드 서버 (`http://localhost:3001/register/registerProcess`)
- **방식**: 직접 요청

## 백엔드 DTO 요구사항 대응

### RegisterDto 필드 매핑
- `userId`: 사용자 아이디
- `password`: 비밀번호
- `confirmPassword`: 비밀번호 확인
- `name`: 이름
- `email`: 이메일
- `phone`: 휴대폰 번호 (010-0000-0000 형식)
- `checkIdPerformed`: 아이디 중복 확인 여부 (boolean)

## 테스트 결과
- ✅ Hydration 오류 해결 완료
- ✅ Check_ID 버튼 정상 작동
- ✅ Register 버튼 정상 작동
- ✅ 휴대폰 번호 자동 포맷팅 및 유효성 검사
- ✅ 백엔드 서버와의 올바른 API 통신

## 주의사항
- 백엔드 서버는 localhost:3001에서 실행되어야 함
- Next.js 개발 서버는 localhost:3000에서 실행
- 휴대폰 번호는 반드시 010으로 시작하는 11자리 형식이어야 함
- 아이디 중복 확인을 완료해야만 회원가입 가능

## 파일 변경 목록
1. `components/header.tsx` - Hydration 오류 수정
2. `app/auth/signup/page.tsx` - 주요 기능 수정 및 개선
3. `app/api/check-id/route.ts` - 기존 파일 유지 (수정 없음)